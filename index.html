<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indigo Career Finder</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            color: #333;
        }
        header {
            background: #35424a;
            color: #ffffff;
            padding: 1rem 0;
            text-align: center;
        }
        header h1 {
            margin: 0;
        }
        main {
            padding: 20px;
            max-width: 960px;
            margin: auto;
        }
        #job-listings-container h2 {
            text-align: center;
            margin-bottom: 20px;
        }
        .job-card {
            background: #fff;
            border: 1px solid #ddd;
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .job-card h3 {
            margin-top: 0;
            color: #35424a;
        }
        .job-card p {
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        .action-btn, .apply-btn {
            display: inline-block;
            background: #5cb85c;
            color: white;
            padding: 8px 15px;
            text-decoration: none;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            text-align: center;
        }
        .action-btn:hover, .apply-btn:hover {
            background: #4cae4c;
        }
        .whatsapp-btn {
            background: #25D366; /* WhatsApp Green */
        }
        .whatsapp-btn:hover {
            background: #1DAE50;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 25px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 8px;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-btn:hover,
        .close-btn:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        #applicationForm div, #whatsAppPromptSection div {
            margin-bottom: 15px;
        }
        #applicationForm label, #whatsAppPromptSection label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        #applicationForm input[type="email"],
        #applicationForm input[type="tel"] {
            width: calc(100% - 22px);
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        #applicationForm small {
            font-size: 0.8em;
            color: #666;
        }
        #applicationForm button[type="submit"], #whatsAppPromptSection button {
            background: #35424a;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1em;
            width: 100%;
        }
        #applicationForm button[type="submit"]:hover, #whatsAppPromptSection button:hover {
            background: #2a3338;
        }
        #applicationForm button[type="submit"]:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .qr-section {
            margin-top: 20px;
            padding: 10px;
            border: 1px dashed #ccc;
            text-align: center;
        }
        .form-message, #whatsAppPromptSection p {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
        }
        .form-message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .form-message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        #whatsAppPromptSection {
            padding-top: 15px;
            text-align: left;
        }
        #whatsAppPromptSection h4 {
            text-align: center;
            color: #35424a;
        }
        #whatsAppPromptSection code {
            background-color: #e9e9e9;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: monospace;
        }
        #whatsAppPromptSection ol li {
            margin-bottom: 5px;
        }
        footer {
            text-align: center;
            padding: 20px;
            background: #35424a;
            color: white;
            margin-top: 30px;
        }
    </style>

    <!-- jsPDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <header>
        <h1>Indigo Career Finder</h1>
    </header>

    <main>
        <section id="job-listings-container">
            <h2>Available Positions</h2>
            <!-- Job cards will be injected here by JavaScript -->
        </section>
    </main>

    <!-- Application Modal -->
    <div id="applicationModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" id="closeModalBtn">×</span>
            <h3 id="modalJobTitle">Apply for Job</h3>

            <form id="applicationForm">
                <input type="hidden" id="appliedJobTitle" name="job_title">
                <div>
                    <label for="email">Email Address:</label>
                    <input type="email" id="email" name="user_email" required>
                </div>
                <div>
                    <label for="phone">Phone Number (India):</label>
                    <input type="tel" id="phone" name="user_phone" pattern="[6-9]\d{9}" title="Enter a 10-digit Indian mobile number starting with 6, 7, 8, or 9" required>
                    <small>Format: 9876543210 (10 digits)</small>
                </div>
                <div class="qr-section">
                    <p>Scan QR to complete payment. You will be asked to send the screenshot via WhatsApp later.</p>
                    <img src="qr.png" alt="Payment QR Code" style="width:150px; height:150px;">
                </div>
                <button type="submit" id="submitApplicationBtn">Generate & Download Application PDF</button>
            </form>
            <div id="whatsAppPromptSection" style="display: none;">
                <!-- Content will be injected by JavaScript -->
            </div>
            <p id="formMessage" class="form-message"></p>
        </div>
    </div>

    <footer>
        <p>© 2023-2024 Indigo Career Solutions</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const jobListingsContainer = document.getElementById('job-listings-container');
            const modal = document.getElementById('applicationModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const applicationForm = document.getElementById('applicationForm');
            const modalJobTitleElement = document.getElementById('modalJobTitle');
            const appliedJobTitleInput = document.getElementById('appliedJobTitle');
            const formMessage = document.getElementById('formMessage');
            const submitBtn = document.getElementById('submitApplicationBtn');
            const whatsAppPromptSection = document.getElementById('whatsAppPromptSection');

            const RECIPIENT_WHATSAPP_NUMBER = "919529014591"; // Your number with country code

            const jobs = [
                { id: 1, title: 'Software Development Intern (Frontend)', company: 'Indigo Tech Innovations', location: 'Remote (India)', description: 'Exciting internship opportunity...' },
                { id: 2, title: 'Junior HR Executive', company: 'Indigo Career Services', location: 'Bangalore, India', description: 'Assist in recruitment...' },
                { id: 3, title: 'Digital Marketing Trainee', company: 'Indigo Marketing Solutions', location: 'Mumbai, India (Hybrid)', description: 'Learn and implement SEO...' },
                { id: 4, title: 'Customer Care Associate (Voice)', company: 'Indigo Support Hub', location: 'Work From Home (Pan India)', description: 'Provide excellent customer support...' }
            ];

            function displayJobs() {
                if (!jobListingsContainer) return;
                const h2 = jobListingsContainer.querySelector('h2') || document.createElement('h2');
                h2.textContent = 'Available Positions';
                jobListingsContainer.innerHTML = '';
                jobListingsContainer.appendChild(h2);

                jobs.forEach(job => {
                    const jobCard = document.createElement('article');
                    jobCard.classList.add('job-card');
                    jobCard.innerHTML = `
                        <h3>${job.title}</h3>
                        <p><strong>Company:</strong> ${job.company}</p>
                        <p><strong>Location:</strong> ${job.location}</p>
                        <p>${job.description}</p>
                        <button class="apply-btn" data-job-title="${job.title}">Apply Now</button>
                    `;
                    jobListingsContainer.appendChild(jobCard);
                });

                document.querySelectorAll('.apply-btn').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const jobTitle = e.target.dataset.jobTitle;
                        openModal(jobTitle);
                    });
                });
            }

            function openModal(jobTitle) {
                modalJobTitleElement.textContent = `Apply for: ${jobTitle}`;
                appliedJobTitleInput.value = jobTitle;
                
                formMessage.textContent = '';
                formMessage.className = 'form-message';
                applicationForm.reset();
                submitBtn.disabled = false;
                submitBtn.textContent = 'Generate & Download Application PDF';
                
                applicationForm.style.display = 'block';
                whatsAppPromptSection.style.display = 'none';
                whatsAppPromptSection.innerHTML = '';

                modal.style.display = 'block';
            }

            function closeModal() {
                modal.style.display = 'none';
                applicationForm.style.display = 'block';
                whatsAppPromptSection.style.display = 'none';
            }

            if (closeModalBtn) {
                closeModalBtn.addEventListener('click', closeModal);
            }

            window.addEventListener('click', (event) => {
                if (event.target === modal) {
                    closeModal();
                }
            });

            function isMobileDevice() {
                // Basic check for mobile user agents.
                return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            }

            if (applicationForm) {
                applicationForm.addEventListener('submit', async function(event) {
                    event.preventDefault();
                    formMessage.textContent = '';
                    formMessage.className = 'form-message';

                    const userEmail = document.getElementById('email').value.trim();
                    const userPhone = document.getElementById('phone').value.trim();
                    const jobTitle = appliedJobTitleInput.value;

                    if (!userEmail || !userPhone) {
                        formMessage.textContent = 'Please fill in your email and phone number.';
                        formMessage.classList.add('error');
                        return;
                    }
                    if (!document.getElementById('phone').checkValidity()) {
                        formMessage.textContent = 'Please enter a valid 10-digit Indian phone number.';
                        formMessage.classList.add('error');
                        return;
                    }

                    submitBtn.disabled = true;
                    submitBtn.textContent = 'Generating PDF...';

                    try {
                        const { jsPDF } = window.jspdf;
                        const doc = new jsPDF();
                        const lineHeight = 7;
                        let currentY = 20;

                        doc.setFontSize(18);
                        doc.text("Job Application Details", 105, currentY, { align: 'center' });
                        currentY += lineHeight * 2;

                        doc.setFontSize(12);
                        doc.text(`Job Title: ${jobTitle}`, 14, currentY);
                        currentY += lineHeight;
                        doc.text(`Applicant Email: ${userEmail}`, 14, currentY);
                        currentY += lineHeight;
                        doc.text(`Applicant Phone: ${userPhone}`, 14, currentY);
                        currentY += lineHeight * 2;

                        doc.setFontSize(10);
                        doc.text("Next Steps (via WhatsApp):", 14, currentY);
                        currentY += lineHeight;
                        doc.text("- This PDF contains your application details.", 14, currentY);
                        currentY += lineHeight;
                        doc.text("- You will need to send this PDF AND your payment screenshot", 14, currentY);
                        currentY += lineHeight;
                        doc.text(`  via WhatsApp to +${RECIPIENT_WHATSAPP_NUMBER.slice(0,2)} ${RECIPIENT_WHATSAPP_NUMBER.slice(2)}.`, 14, currentY);


                        const pdfFileName = `Application_${jobTitle.replace(/[^a-zA-Z0-9]/g, '_')}_${userEmail.split('@')[0]}.pdf`;
                        doc.save(pdfFileName);

                        formMessage.textContent = `PDF "${pdfFileName}" downloaded! Check your Downloads folder.`;
                        formMessage.classList.add('success');
                        
                        applicationForm.style.display = 'none';
                        showWhatsAppPrompt(jobTitle, userEmail, userPhone, pdfFileName);

                    } catch (error) {
                        console.error("Error generating PDF:", error);
                        formMessage.textContent = 'Error generating PDF. Please try again.';
                        formMessage.classList.add('error');
                    } finally {
                        submitBtn.disabled = false;
                        submitBtn.textContent = 'Generate & Download Application PDF';
                    }
                });
            }

            function showWhatsAppPrompt(jobTitle, userEmail, userPhone, pdfFileName) {
                const preFilledMessage = `Job Application Submission:
Job Title: ${jobTitle}
Applicant Email: ${userEmail}
Applicant Phone: ${userPhone}

I have attached the application PDF (${pdfFileName}) and my payment screenshot for this application.`;

                let whatsAppUrl;
                if (isMobileDevice()) {
                    whatsAppUrl = `https://wa.me/${RECIPIENT_WHATSAPP_NUMBER}?text=${encodeURIComponent(preFilledMessage)}`;
                } else {
                    whatsAppUrl = `https://web.whatsapp.com/send?phone=${RECIPIENT_WHATSAPP_NUMBER}&text=${encodeURIComponent(preFilledMessage)}`;
                }

                whatsAppPromptSection.innerHTML = `
                    <h4>Next: Send via WhatsApp</h4>
                    <p>Your application PDF (<code>${pdfFileName}</code>) has been downloaded to your computer/device (usually in your "Downloads" folder).</p>
                    <p><strong>CRITICAL NEXT STEP:</strong></p>
                    <ol>
                        <li>Click the button below to open WhatsApp.</li>
                        <li>A chat with <strong>+${RECIPIENT_WHATSAPP_NUMBER}</strong> will open with a pre-filled message.</li>
                        <li>In the WhatsApp chat, you MUST MANUALLY ATTACH **TWO (2)** FILES:
                            <ul>
                                <li>The PDF you just downloaded (<code>${pdfFileName}</code>).</li>
                                <li>Your payment screenshot image.</li>
                            </ul>
                        </li>
                        <li>Review the message and attachments, then send it via WhatsApp.</li>
                    </ol>
                    <a href="${whatsAppUrl}" class="action-btn whatsapp-btn" target="_blank" style="width: calc(100% - 30px); margin-bottom:10px;">Open WhatsApp to Send Application</a>
                    <button id="promptCloseBtn" class="action-btn" style="background-color:#777; width: calc(100% - 30px);">Close This Message</button>
                `;
                whatsAppPromptSection.style.display = 'block';

                document.getElementById('promptCloseBtn').addEventListener('click', () => {
                    closeModal();
                });
            }

            displayJobs();
        });
    </script>

</body>
</html>
